(function(e){var n={fields:[],minLength:3,fieldMap:{},searchField:null,suggestionHoverClass:"wnt-hover"},d={init:function(a){return!a.ajaxUrl?(e.error('The "ajaxUrl" option must be included when initializing the plugin.'),this):!a.ajaxAction?(e.error('The "ajaxAction" option must be included when initializing the plugin.'),this):this.each(function(){var b=e(this),c=e.extend(!0,{},n,a);0===c.fields.length&&c.fields.push(b.attr("name"));b.data("wolfnetSmartSearch.state",c);d.createInputControl(b);d.createSuggestionControl(b);
d.defineEvents(b);d.refreshExistingValues(b,null,!1)})},disable:function(){return this.each(function(){var a=e(this),b=a.data("wolfnetSmartSearch.state").listContainer;a.prop("disabled",!0);b.hide()})},enable:function(){return this.each(function(){var a=e(this),b=a.data("wolfnetSmartSearch.state").listContainer;a.prop("disabled",!1);b.show()})},getContainer:function(){var a=e();this.each(function(){var b=e(this).data("wolfnetSmartSearch.state").listContainer;a=a.add(b)});return a},createInputControl:function(a){var b=
e(a[0].form),c=a.data("wolfnetSmartSearch.state"),f=e("<input>").attr({autocomplete:"off",name:"q"==a.attr("name")?"q":"",placeholder:a.attr("placeholder"),type:"text"}).css({outline:"none",minWidth:"5em",width:"100%"}).val(a.val()),g=e("<span>").addClass("wnt-smart-search-input").css({display:"inline-block",width:"100%"}).append(f),g=e("<span>").addClass(a.attr("class")).css({"text-align":"left"}).append(g).click(function(){f.focus()}).resize(function(){d.resizeSuggestionsList(a)}).insertBefore(a);
a.is(":focus")&&f.focus();a.hide();a.prependTo(b);"q"==a.attr("name")&&(a.removeAttr("name"),f.val(a.val()));c.searchInput=f;c.listContainer=g;a.data("wolfnetSmartSearch.state",c)},createSuggestionControl:function(a){var b=a.data("wolfnetSmartSearch.state"),c=b.listContainer;b.searchingClass="wnt-message-searching"+b.componentId;var d=e("<div>").addClass(b.searchingClass).text("Searching ..."),c=e("<div>").addClass("wnt-suggestions").css({position:"absolute",left:0,width:c.outerWidth()+1,backgroundColor:"white",
zIndex:9E6}).hide().append(d).appendTo(e(".smart-menu"+b.componentId));b.suggestionContainer=c;a.data("wolfnetSmartSearch.state",b)},updateSuggestionsList:function(a,b){var c=a.data("wolfnetSmartSearch.state"),f=c.suggestionContainer,c=c.suggestionHoverClass;d.resizeSuggestionsList(a);d.resetSuggestionsList(a);if(0<b.length){for(var g in b){var h=e("<span>").text(b[g].value).addClass("wolfnet-suggestion-label"),i=e("<span>").text(b[g].label).addClass("wolfnet-suggestion-field"),j=e("<span>").css("clear",
"both");e("<div>").addClass("wnt-suggestion").data("value",b[g].value).data("field",b[g].field).append(h).append(i).append(j).appendTo(f).on("click",d.suggestionClick).on("mouseover",{$smartSearch:a},d.suggestionMouseover).on("wntSelect",{$smartSearch:a},d.suggestionOnWntSearch)}f.children(".wnt-suggestion:first").addClass(c);d.showSuggestionsList(a)}else d.resetSuggestionsList(a)},defineEvents:function(a){var b=a.data("wolfnetSmartSearch.state"),c=b.searchInput,f=b.suggestionContainer,g=e(a[0].form);
a.on("wntFocus",function(){c.focus()});for(var h=0,i=b.fields.length;h<i;h++)g.find('input[name="'+b.fields[h]+'"]').on("change",{$smartSearch:a},d.fieldChange);c.on("keydown",{$smartSearch:a},d.searchInputKeydown).on("keyup",{$smartSearch:a},d.searchInputKeyup).on("blur",{$smartSearch:a},d.searchInputBlur).on("focus",{$smartSearch:a},d.searchInputFocus);f.on("mouseover",{$smartSearch:a},d.suggestionContainerMouseover).on("mouseout",{$smartSearch:a},d.suggestionContainerMouseout);g.on("reset",function(){d.removeAllValues(a)})},
getFieldNameFromFieldMap:function(a,b){return(a.data("wolfnetSmartSearch.state").fieldMap||{})[b]||b},suggestionsVisibleWithResults:function(a){var b=a.data("wolfnetSmartSearch.state").suggestionContainer,a=b.is(":not(:hidden)"),b=0<b.find(".wnt-suggestion").length;return a&&b},widestElementWidth:function(a){var b=0;a.each(function(){var a=e(this).outerWidth();b=a>b?a:b});return b},input:function(a,b){var c=a.data("wolfnetSmartSearch.state");c.xhr&&c.xhr.abort();if(b.length>=c.minLength){var f={term:b};
c.searchField&&(f.field=c.searchField);c.xhr=e.ajax({url:c.ajaxUrl,data:{action:c.ajaxAction,data:f},dataType:"jsonp",context:a,beforeSend:function(){d.showSearchingMessage(this)}}).done(function(a){d.updateSuggestionsList(this,a)}).always(function(){d.hideSearchingMessage(this)});a.data("wolfnetSmartSearch.state",c)}else d.resetSuggestionsList(a)},addValue:function(a,b,c,f){var f="undefined"!==typeof f?f:!1,g=a.data("wolfnetSmartSearch.state"),h=e(a[0].form),i=g.searchInput,j=!1,c=d.getFieldNameFromFieldMap(a,
c),g=h.find('input[name="'+c+'"]');0===g.length&&(g=e("<input>").attr({name:c,type:"hidden"}).appendTo(h));h=g.val().split(",");-1==e.inArray(b,h)&&(j=!0,h.push(b));g.val(h.join(",").replace(/(^,)|(,$)/g,""));c=e("<span>").data("value",b).data("field",c).addClass("wnt-ss-value").css("display","inline-block").on("wntRemove",function(){var b=e(this),c=b.data("value"),b=b.data("field");d.removeValue(a,c,b)});e("<span>").text(b).appendTo(c);e("<span>").addClass("wnt-close-btn").addClass("icon").addClass("icon-close").html("<span>x</span>").appendTo(c).click(function(){e(this).parent().trigger("wntRemove")});
c.insertBefore(i.parent());d.resizeSuggestionsList(a);f||(a.trigger("wntSmartSearchUpdated"),j&&(b=jQuery.Event("change"),b.relatedTarget=a[0],g.trigger(b)))},removeValue:function(a,b,c){var f=a.data("wolfnetSmartSearch.state").listContainer,g=e(a[0].form),h=!1,c=d.getFieldNameFromFieldMap(a,c)||c,g=g.find('input[name="'+c+'"]');if(0!==g.length){var i=e.grep(g.val().split(","),function(a){h=a==b?!0:h;return a!=b});g.val(i.join(",").replace(/(^,)|(,$)/g,""));f.children(".wnt-ss-value").each(function(){var a=
e(this),d=a.data("value")||"",f=a.data("field")||"";d==b&&(c&&f==c)&&a.remove()});d.resizeSuggestionsList(a);a.trigger("wntSmartSearchUpdated");h&&(f=jQuery.Event("change"),f.relatedTarget=a[0],g.trigger(f))}},removeAllValues:function(a){a.data("wolfnetSmartSearch.state").listContainer.children(".wnt-ss-value").each(function(){var b=e(this),c=b.data("value")||"",b=b.data("field")||"";""!==c&&""!==b&&d.removeValue(a,c,b)})},removeMostRecentValue:function(a){(a.data("wolfnetSmartSearch.state").listContainer||
e("<span>")).children(".wnt-ss-value:last").trigger("wntRemove")},showSuggestionsList:function(a){var a=a.data("wolfnetSmartSearch.state").suggestionContainer.show(),b=d.widestElementWidth(a.find(".wolfnet-suggestion-field")),c=a.find(".wnt-suggestion:first").width()-b;a.find(".wolfnet-suggestion-label").each(function(){var a=e(this);a.width()>c-10&&a.width(c-10)})},hideSuggestionsList:function(a){a.data("wolfnetSmartSearch.state").suggestionContainer.hide()},resetSuggestionsList:function(a){var b=
a.data("wolfnetSmartSearch.state").suggestionContainer.children(".wnt-suggestion");d.hideSuggestionsList(a);b.remove()},moveSuggestionSelectUp:function(a){var a=a.data("wolfnetSmartSearch.state").suggestionContainer.find(".wnt-suggestion.wnt-hover"),b=a.prev(".wnt-suggestion");b.length&&(b.addClass("wnt-hover"),a.removeClass("wnt-hover"))},moveSuggestionSelectDown:function(a){var a=a.data("wolfnetSmartSearch.state").suggestionContainer.find(".wnt-suggestion.wnt-hover"),b=a.next(".wnt-suggestion");
b.length&&(b.addClass("wnt-hover"),a.removeClass("wnt-hover"))},selectHighlightedSuggestion:function(a){a.data("wolfnetSmartSearch.state").suggestionContainer.find(".wnt-suggestion.wnt-hover").trigger("wntSelect")},showSearchingMessage:function(a){var b=a.data("wolfnetSmartSearch.state");b.suggestionContainer.children("."+b.searchingClass).show();d.showSuggestionsList(a)},hideSearchingMessage:function(a){a=a.data("wolfnetSmartSearch.state");a.suggestionContainer.children("."+a.searchingClass).hide()},
refreshExistingValues:function(a,b,c){for(var c="undefined"!==typeof c?c:!1,b=e(a[0].form),f=a.data("wolfnetSmartSearch.state"),g=f.listContainer,h={},i=[],j=[],l=0,n=f.fields.length;l<n;l++){var k=b.find('input[name="'+f.fields[l]+'"]');if(0!==k.length){k=e.trim(k.val()).split(",");h[f.fields[l]]=k;for(var m=0,o=k.length;m<o;m++){var p=f.fields[l],q=k[m];""!==e.trim(k[m])&&i.push({field:p,value:q})}}}g.find("span.wnt-ss-value").each(function(){for(var a=e(this),a={field:a.data("field"),value:a.data("value")},
b=0,c=[],d=i.length;b<d;b++){var f=i[b];(f.field!=a.field||f.value!=a.value)&&c.push(f)}i=c;(!h[a.field]||-1==e.inArray(a.value,h[a.field]))&&j.push(a)});b=0;for(f=i.length;b<f;b++)d.addValue(a,i[b].value,i[b].field,c);c=0;for(b=j.length;c<b;c++)d.removeValue(a,j[c].value,j[c].field)},resizeSuggestionsList:function(a){var b=a.data("wolfnetSmartSearch.state"),c=b.listContainer,b=b.suggestionContainer;c.offset();d.toggleInputPlaceholder(a);a=c.outerWidth()+parseInt(c.css("margin-left"))+parseInt(c.css("margin-right"));
b.css({top:top,left:0,width:a})},toggleInputPlaceholder:function(a){var b=a.data("wolfnetSmartSearch.state"),c=b.searchInput;0===b.listContainer.children(".wnt-ss-value").children().length?(e(".wnt-smart-search-input").css("width","100%"),c.attr("placeholder",a.attr("placeholder")).css("width","100%")):(e(".wnt-smart-search-input").css("width",0),c.attr("placeholder","").css("width","auto"))},searchInputKeydown:function(a){var b=e(this),c=a.data.$smartSearch;switch(a.keyCode){case 9:case 16:case 17:case 18:case 19:case 20:case 33:case 34:case 35:case 36:case 37:case 39:case 45:case 91:case 92:case 93:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 144:case 145:case 186:case 187:case 188:case 189:case 192:return!0;
case 13:if(""!==b.val()&&d.suggestionsVisibleWithResults(c))return a.preventDefault(),d.selectHighlightedSuggestion(c),!1;break;case 8:""===b.val()&&d.removeMostRecentValue(c);break;case 40:case 38:return a.preventDefault(),!1}},searchInputKeyup:function(a){var b=e(this),c=a.data.$smartSearch;b.parent().parent();var f=e(c[0].form);"q"==c.attr("name")&&c.trigger(a);switch(a.keyCode){case 9:case 16:case 17:case 18:case 19:case 20:case 33:case 34:case 35:case 36:case 37:case 39:case 45:case 91:case 92:case 93:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 144:case 145:case 186:case 187:case 188:case 189:case 192:return!0;
case 27:return d.hideSuggestionsList(c),!1;case 13:if(d.suggestionsVisibleWithResults(c))return a.preventDefault(),!1;f.submit();return!0;case 40:return a.preventDefault(),d.moveSuggestionSelectDown(c),!1;case 38:return a.preventDefault(),d.moveSuggestionSelectUp(c),!1;case 8:return d.input(c,b.val()),d.toggleInputPlaceholder(c),!0;default:d.input(c,b.val())}},searchInputBlur:function(a){var a=a.data.$smartSearch,b=a.data("wolfnetSmartSearch.state");b.listContainer.removeClass("focus");b.overSuggestions||
d.hideSuggestionsList(a)},searchInputFocus:function(a){a=a.data.$smartSearch;a.data("wolfnetSmartSearch.state").listContainer.addClass("focus");d.resetSuggestionsList(a)},suggestionContainerMouseover:function(a){var a=a.data.$smartSearch,b=a.data("wolfnetSmartSearch.state");b.overSuggestions=!0;a.data("wolfnetSmartSearch.state",b)},suggestionContainerMouseout:function(a){var a=a.data.$smartSearch,b=a.data("wolfnetSmartSearch.state"),c=b.searchInput;b.overSuggestions=!1;a.data("wolfnetSmartSearch.state",
b);c.is(":focus")||d.hideSuggestionsList(a)},suggestionClick:function(){e(this).trigger("wntSelect")},suggestionMouseover:function(a){var b=e(this),a=a.data.$smartSearch.data("wolfnetSmartSearch.state").suggestionHoverClass;b.addClass(a);b.siblings("."+a).removeClass(a)},suggestionOnWntSearch:function(a){var b=e(this),a=a.data.$smartSearch,c=a.data("wolfnetSmartSearch.state").searchInput,f=b.data("value"),b=b.data("field");c.val("");d.resetSuggestionsList(a);d.addValue(a,f,b);a.trigger("wntFocus")},
fieldChange:function(a){var b=a.data.$smartSearch;a.relatedTarget!=b[0]&&d.refreshExistingValues(b,a)}};e.fn.wolfnetSmartSearch=function(a){if(d[a])return d[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return d.init.apply(this,arguments);e.error("Method "+a+" does not exist on jQuery."+pluginName)}})(jQuery);
